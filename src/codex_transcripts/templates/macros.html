{# Pagination for regular pages #}
{% macro pagination(current_page, total_pages) %}
{% if total_pages <= 1 %}
<div class="pagination"><a href="index.html" class="index-link">Index</a></div>
{%- else %}
<div class="pagination">
<a href="index.html" class="index-link">Index</a>
{% if current_page > 1 -%}
<a href="page-{{ '%03d'|format(current_page - 1) }}.html">&larr; Prev</a>
{%- else -%}
<span class="disabled">&larr; Prev</span>
{%- endif %}
{% for page in range(1, total_pages + 1) -%}
{% if page == current_page -%}
<span class="current">{{ page }}</span>
{%- else -%}
<a href="page-{{ '%03d'|format(page) }}.html">{{ page }}</a>
{%- endif %}
{% endfor -%}
{% if current_page < total_pages -%}
<a href="page-{{ '%03d'|format(current_page + 1) }}.html">Next &rarr;</a>
{%- else -%}
<span class="disabled">Next &rarr;</span>
{%- endif %}
</div>
{%- endif %}
{% endmacro %}

{# Pagination for index page #}
{% macro index_pagination(total_pages) %}
{% if total_pages < 1 %}
<div class="pagination"><span class="current">Index</span></div>
{%- else %}
<div class="pagination">
<span class="current">Index</span>
<span class="disabled">&larr; Prev</span>
{% for page in range(1, total_pages + 1) -%}
<a href="page-{{ '%03d'|format(page) }}.html">{{ page }}</a>
{% endfor -%}
{% if total_pages >= 1 -%}
<a href="page-001.html">Next &rarr;</a>
{%- else -%}
<span class="disabled">Next &rarr;</span>
{%- endif %}
</div>
{%- endif %}
{% endmacro %}

{# Shell tool #}
{% macro shell_tool(command, workdir, tool_id) %}
<div class="tool-use" data-tool-id="{{ tool_id }}">
<div class="tool-header"><span class="tool-icon">$</span> Shell</div>
{%- if workdir %}
<div class="tool-description">workdir: {{ workdir }}</div>
{%- endif %}
<div class="truncatable"><div class="truncatable-content"><pre class="bash-command">{{ command }}</pre></div><button class="expand-btn">Show more</button></div>
</div>
{%- endmacro %}

{# Patch tool #}
{% macro patch_tool(content, tool_id) %}
<div class="file-tool patch-tool" data-tool-id="{{ tool_id }}">
<div class="file-tool-header patch-header"><span class="file-tool-icon">#</span> Patch</div>
<div class="truncatable"><div class="truncatable-content"><pre class="file-content">{{ content }}</pre></div><button class="expand-btn">Show more</button></div>
</div>
{%- endmacro %}

{# Plan update tool #}
{% macro plan_update(plan, explanation, tool_id) %}
<div class="plan-update" data-tool-id="{{ tool_id }}">
<div class="plan-header"><span class="tool-icon">*</span> Plan update</div>
{%- if explanation %}
<div class="plan-explanation">{{ explanation }}</div>
{%- endif %}
<ul class="plan-items">
{%- for item in plan -%}
{%- set status = item.status|default('pending') -%}
{%- if status == 'completed' -%}
{%- set icon = 'x' -%}
{%- set status_class = 'plan-completed' -%}
{%- elif status == 'in_progress' -%}
{%- set icon = '>' -%}
{%- set status_class = 'plan-in-progress' -%}
{%- else -%}
{%- set icon = 'o' -%}
{%- set status_class = 'plan-pending' -%}
{%- endif -%}
<li class="plan-item {{ status_class }}"><span class="plan-icon">{{ icon }}</span><span>{{ item.step }}</span></li>
{%- endfor -%}
</ul>
</div>
{%- endmacro %}

{# Generic tool use - input_json is pre-formatted so needs |safe #}
{% macro tool_use(tool_name, description, input_json, tool_id) %}
<div class="tool-use" data-tool-id="{{ tool_id }}"><div class="tool-header"><span class="tool-icon">*</span> {{ tool_name }}</div>
{%- if description -%}
<div class="tool-description">{{ description }}</div>
{%- endif -%}
<div class="truncatable"><div class="truncatable-content"><pre class="json">{{ input_json }}</pre></div><button class="expand-btn">Show more</button></div></div>
{%- endmacro %}

{# Tool result - content_html is pre-rendered so needs |safe #}
{% macro tool_result(content_html, is_error) %}
{%- set error_class = ' tool-error' if is_error else '' -%}
<div class="tool-result{{ error_class }}"><div class="truncatable"><div class="truncatable-content">{{ content_html|safe }}</div><button class="expand-btn">Show more</button></div></div>
{%- endmacro %}

{# Assistant text - content_html is pre-rendered markdown so needs |safe #}
{% macro assistant_text(content_html) %}
<div class="assistant-text">{{ content_html|safe }}</div>
{%- endmacro %}

{# User content - content_html is pre-rendered so needs |safe #}
{% macro user_content(content_html) %}
<div class="user-content">{{ content_html|safe }}</div>
{%- endmacro %}

{# Commit card (in tool results) #}
{% macro commit_card(commit_hash, commit_msg, github_repo) %}
{%- if github_repo -%}
{%- set github_link = 'https://github.com/' ~ github_repo ~ '/commit/' ~ commit_hash -%}
<div class="commit-card"><a href="{{ github_link }}"><span class="commit-card-hash">{{ commit_hash[:7] }}</span> {{ commit_msg }}</a></div>
{%- else -%}
<div class="commit-card"><span class="commit-card-hash">{{ commit_hash[:7] }}</span> {{ commit_msg }}</div>
{%- endif %}
{%- endmacro %}

{# Message wrapper - content_html is pre-rendered so needs |safe #}
{% macro message(role_class, role_label, msg_id, timestamp, content_html) %}
<div class="message {{ role_class }}" id="{{ msg_id }}"><div class="message-header"><span class="role-label">{{ role_label }}</span><a href="#{{ msg_id }}" class="timestamp-link"><time datetime="{{ timestamp }}" data-timestamp="{{ timestamp }}">{{ timestamp }}</time></a></div><div class="message-content">{{ content_html|safe }}</div></div>
{%- endmacro %}

{# Index item (prompt) - rendered_content and stats_html are pre-rendered so need |safe #}
{% macro index_item(prompt_num, link, timestamp, rendered_content, stats_html) %}
<div class="index-item"><a href="{{ link }}"><div class="index-item-header"><span class="index-item-number">#{{ prompt_num }}</span><time datetime="{{ timestamp }}" data-timestamp="{{ timestamp }}">{{ timestamp }}</time></div><div class="index-item-content">{{ rendered_content|safe }}</div></a>{{ stats_html|safe }}</div>
{%- endmacro %}

{# Index commit #}
{% macro index_commit(commit_hash, commit_msg, timestamp, github_repo) %}
{%- if github_repo -%}
{%- set github_link = 'https://github.com/' ~ github_repo ~ '/commit/' ~ commit_hash -%}
<div class="index-commit"><a href="{{ github_link }}"><div class="index-commit-header"><span class="index-commit-hash">{{ commit_hash[:7] }}</span><time datetime="{{ timestamp }}" data-timestamp="{{ timestamp }}">{{ timestamp }}</time></div><div class="index-commit-msg">{{ commit_msg }}</div></a></div>
{%- else -%}
<div class="index-commit"><div class="index-commit-header"><span class="index-commit-hash">{{ commit_hash[:7] }}</span><time datetime="{{ timestamp }}" data-timestamp="{{ timestamp }}">{{ timestamp }}</time></div><div class="index-commit-msg">{{ commit_msg }}</div></div>
{%- endif %}
{%- endmacro %}

{# Index stats - tool_stats_str and long_texts_html are pre-rendered so need |safe #}
{% macro index_stats(tool_stats_str, long_texts_html) %}
{%- if tool_stats_str or long_texts_html -%}
<div class="index-item-stats">
{%- if tool_stats_str -%}<span>{{ tool_stats_str }}</span>{%- endif -%}
{{ long_texts_html|safe }}
</div>
{%- endif %}
{%- endmacro %}

{# Long text in index - rendered_content is pre-rendered markdown so needs |safe #}
{% macro index_long_text(rendered_content) %}
<div class="index-item-long-text"><div class="truncatable"><div class="truncatable-content"><div class="index-item-long-text-content">{{ rendered_content|safe }}</div></div><button class="expand-btn">Show more</button></div></div>
{%- endmacro %}

{# System instructions #}
{% macro system_instructions(rendered_content, repeat_count) %}
<details class="system-instructions" id="system-instructions">
<summary>System instructions{% if repeat_count > 1 %} (reused {{ repeat_count }} times){% endif %}</summary>
<div class="system-instructions-content">{{ rendered_content|safe }}</div>
</details>
{%- endmacro %}

{# Session metadata #}
{% macro session_meta(meta) %}
<div class="session-meta">
{%- if meta.session_id %}
<div class="meta-item"><span class="meta-label">Session</span>{{ meta.session_id }}</div>
{%- endif %}
{%- if meta.started_at %}
<div class="meta-item"><span class="meta-label">Started</span><time datetime="{{ meta.started_at }}" data-timestamp="{{ meta.started_at }}">{{ meta.started_at }}</time></div>
{%- endif %}
{%- if meta.cwd %}
<div class="meta-item"><span class="meta-label">CWD</span>{{ meta.cwd }}</div>
{%- endif %}
{%- if meta.repo %}
<div class="meta-item"><span class="meta-label">Repo</span>{{ meta.repo }}</div>
{%- endif %}
{%- if meta.branch %}
<div class="meta-item"><span class="meta-label">Branch</span>{{ meta.branch }}</div>
{%- endif %}
{%- if meta.commit %}
<div class="meta-item"><span class="meta-label">Commit</span>{{ meta.commit[:7] }}</div>
{%- endif %}
</div>
{%- endmacro %}
